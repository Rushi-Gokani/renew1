{%- comment -%}
  Background image/video snippet with mobile fallbacks.
  Paste this in place of your current block.
{%- endcomment -%}

{%- comment -%} Normalise variables so snippet works when rendered globally or inside a section {%- endcomment -%}
{%- if background_image == nil and section and section.settings and section.settings.background_image != blank -%}
  {%- assign background_image = section.settings.background_image -%}
{%- endif -%}

{%- if background_image_mobile == nil and section and section.settings and section.settings.background_image_mobile != blank -%}
  {%- assign background_image_mobile = section.settings.background_image_mobile -%}
{%- endif -%}

{%- if background_video == nil and section and section.settings and section.settings.video != blank -%}
  {%- assign background_video = section.settings.video -%}
{%- endif -%}

{%- if background_video_mobile == nil and section and section.settings and section.settings.video_mobile != blank -%}
  {%- assign background_video_mobile = section.settings.video_mobile -%}
{%- endif -%}

{%- if background_image_position == nil and section and section.settings and section.settings.background_image_position != blank -%}
  {%- assign background_image_position = section.settings.background_image_position -%}
{%- endif -%}

<div class="background-image-container{% if background_image_position == 'fit' %} background-image-fit{% endif %}">
  {% liquid
    assign media_width_desktop = '100vw'
    assign media_width_mobile = '100vw'
    assign sizes = '(min-width: 750px) ' | append: media_width_desktop | append: ', ' | append: media_width_mobile
    assign widths = '240, 352, 832, 1200, 1600, 1920, 2560, 3840'
  %}

  {% liquid
    assign fetch_priority = 'auto'
    if section and section.index == 1
      assign fetch_priority = 'high'
    endif
  %}

  {%- if background_video != blank or background_video_mobile != blank -%}
    {%- if background_video != blank -%}
      <video
        class="background-video background-video--desktop"
        autoplay
        loop
        muted
        playsinline
        aria-hidden="true"
        {% if background_image_position == 'cover' %} data-object-fit="cover" {% endif %}
      >
        <source src="{{ background_video | file_url }}" type="video/mp4">
      </video>
    {%- endif -%}

    {%- if background_video_mobile != blank -%}
      <video
        class="background-video background-video--mobile"
        autoplay
        loop
        muted
        playsinline
        aria-hidden="true"
        {% if background_image_position == 'cover' %} data-object-fit="cover" {% endif %}
      >
        <source src="{{ background_video_mobile | file_url }}" type="video/mp4">
      </video>
    {%- elsif background_video != blank -%}
      <video
        class="background-video background-video--mobile"
        autoplay
        loop
        muted
        playsinline
        aria-hidden="true"
        {% if background_image_position == 'cover' %} data-object-fit="cover" {% endif %}
      >
        <source src="{{ background_video | file_url }}" type="video/mp4">
      </video>
    {%- endif -%}

  {%- else -%}
    {%- if background_image != blank -%}
      <picture>
        {%- if background_image_mobile != blank -%}
          {%- assign mobile_widths = widths | split: ', ' -%}
          {%- capture mobile_srcset -%}
            {%- for w in mobile_widths -%}
              {{ background_image_mobile | image_url: width: w }} {{ w }}w{% unless forloop.last %}, {% endunless %}
            {%- endfor -%}
          {%- endcapture -%}
          {%- comment -%}
            Mobile source: devices <= 1024px will prefer this srcset.
            Change the media query to (max-width:767px) if you only want phones.
          {%- endcomment -%}
          <source media="(max-width: 1024px)" srcset="{{ mobile_srcset | strip }}" sizes="{{ sizes }}">
        {%- endif -%}

        {{ background_image
          | image_url: width: 3840
          | image_tag: height: height, sizes: sizes, widths: widths, loading: 'eager', fetchpriority: fetch_priority, alt: ''
        }}
      </picture>
    {%- else -%}
      {%- assign placeholder_name = placeholder | default: 'hero-apparel-2' -%}
      {%- if placeholder_name == blank -%}
        {%- assign placeholder_name = 'hero-apparel-2' -%}
      {%- endif -%}
      {{ placeholder_name | placeholder_svg_tag }}
    {%- endif -%}
  {%- endif -%}
</div>

<style>
/* 1) Remove any overlay tint that might be above the image */
.background-image-container .overlay,
.background-image-container .section__overlay,
.background-image-container::before,
.background-image-container::after {
  display: none !important;
  background: transparent !important;
}

/* 2) Ensure <picture>/<img> fills the container and covers (no gray gap) */
.background-image-container,
.background-image-container picture,
.background-image-container img {
  display: block;
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
}

.background-image-container img {
  object-fit: cover;       /* fill and crop to cover container */
  object-position: center; /* center the crop */
  background: transparent;
}

/* 3) If the section itself has a background color, make it transparent */
.background-image-container,
.background-image-container .section,
.background-image-container .section-wrapper,
.background-image-container .section-inner {
  background-color: transparent !important;
  background: transparent !important;
}

</style>
